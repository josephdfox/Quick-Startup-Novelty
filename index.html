<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Novelty Index</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://cdn.skypack.dev/react@18.2.0",
        "react-dom": "https://cdn.skypack.dev/react-dom@18.2.0",
        "recharts": "https://cdn.skypack.dev/recharts@2.12.7",
        "@xenova/transformers": "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2",
        "html-to-image": "https://cdn.skypack.dev/html-to-image@1.11.11"
      }
    }
    </script>

    <style>
        body { background-color: #101e22; color: #f1f5f9; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .scanning-line {
            position: absolute; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, #0db9f2, transparent);
            box-shadow: 0 0 15px #0db9f2; animation: scan-line 3s linear infinite; z-index: 10;
        }
        @keyframes scan-line { 0% { top: -10%; } 100% { top: 110%; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom';
        import { ScatterChart, Scatter, XAxis, YAxis, ZAxis, ResponsiveContainer, Cell } from 'recharts';
        import { pipeline, env } from '@xenova/transformers';

        const REGISTRY_DATA = [
            "Uber for dog walking", "Airbnb for photo studios", "SaaS for freelancer taxes",
            "Social network for vintage cars", "Sustainable building marketplace", "AI coding for legacy systems",
            "Drone medical delivery", "Blockchain corporate voting", "Succulent subscription box"
        ];

        const App = () => {
            const [pitch, setPitch] = useState('');
            const [isReady, setIsReady] = useState(false);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [points, setPoints] = useState([]);
            const [result, setResult] = useState(null);
            
            const extractorRef = useRef(null);
            const databaseRef = useRef([]);

            useEffect(() => {
                async function init() {
                    env.allowLocalModels = false;
                    const extractor = await pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2');
                    extractorRef.current = extractor;

                    const initialPoints = [];
                    for (let i = 0; i < REGISTRY_DATA.length; i++) {
                        const out = await extractor(REGISTRY_DATA[i], { pooling: 'mean', normalize: true });
                        const vec = out.data;
                        const x = (vec[0] * 100);
                        const y = (vec[1] * 100);
                        databaseRef.current.push({ text: REGISTRY_DATA[i], vec });
                        initialPoints.push({ x, y, id: i, isUser: false });
                    }
                    setPoints(initialPoints);
                    setIsReady(true);
                }
                init();
            }, []);

            const handleAnalyze = async () => {
                if (!pitch) return;
                setIsAnalyzing(true);
                const out = await extractorRef.current(pitch, { pooling: 'mean', normalize: true });
                const userVec = out.data;
                const userX = (userVec[0] * 100);
                const userY = (userVec[1] * 100);

                const userPoint = { x: userX, y: userY, id: 'user', isUser: true };
                setPoints(prev => [...prev.filter(p => !p.isUser), userPoint]);
                setResult({ score: 8, title: "Strategic Entry" });
                setIsAnalyzing(false);
            };

            return (
                <div className="p-8 max-w-6xl mx-auto">
                    <header className="mb-12">
                        <h1 className="text-5xl font-black italic text-primary">Novelty Index.</h1>
                        <p className="text-gray-400 mt-2">Local AI Analysis â€¢ GitHub Pages Ready</p>
                    </header>

                    {!isReady ? (
                        <div className="h-64 flex items-center justify-center font-bold animate-pulse">Loading Brain...</div>
                    ) : (
                        <div className="grid lg:grid-cols-2 gap-12">
                            <div className="space-y-6">
                                <textarea 
                                    className="w-full h-48 p-6 rounded-3xl bg-slate-800 border border-slate-700 text-white focus:ring-2 focus:ring-primary outline-none"
                                    placeholder="Enter your startup pitch here..."
                                    value={pitch}
                                    onChange={(e) => setPitch(e.target.value)}
                                />
                                <button 
                                    onClick={handleAnalyze}
                                    disabled={isAnalyzing}
                                    className="w-full py-4 rounded-2xl bg-[#0db9f2] text-black font-black text-xl hover:bg-white transition-colors"
                                >
                                    {isAnalyzing ? "Analyzing..." : "Analyze Pitch"}
                                </button>
                            </div>

                            <div className="h-[400px] bg-slate-900 rounded-[2rem] border border-slate-700 relative overflow-hidden">
                                {isAnalyzing && <div className="scanning-line"></div>}
                                <ResponsiveContainer width="100%" height="100%">
                                    <ScatterChart margin={{ top: 40, right: 40, bottom: 40, left: 40 }}>
                                        <XAxis type="number" dataKey="x" hide domain={[-20, 20]} />
                                        <YAxis type="number" dataKey="y" hide domain={[-20, 20]} />
                                        <ZAxis type="number" range={[100, 400]} />
                                        <Scatter data={points} shape="circle">
                                            {points.map((entry, index) => (
                                                <Cell 
                                                    key={`cell-${index}`} 
                                                    fill={entry.isUser ? '#0db9f2' : '#223f49'} 
                                                    className={entry.isUser ? 'animate-bounce' : ''}
                                                />
                                            ))}
                                        </Scatter>
                                    </ScatterChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
