<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Startup Novelty Index</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #101e22;
            color: #f1f5f9;
            font-family: 'Inter', sans-serif;
        }
        .scanning-line {
            position: absolute;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #0db9f2, transparent);
            box-shadow: 0 0 15px #0db9f2;
            animation: scan-line 3s linear infinite;
            z-index: 10;
        }
        @keyframes scan-line {
            0% { top: -10%; }
            100% { top: 110%; }
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex flex-col p-6 md:p-12">
        <header class="max-w-6xl mx-auto w-full mb-12 flex justify-between items-center">
            <h1 class="text-3xl font-black tracking-tighter text-white">
                NOVELTY<span class="text-[#0db9f2]">.AI</span>
            </h1>
            <div class="text-[10px] font-bold uppercase tracking-widest text-slate-500 bg-slate-800/50 px-3 py-1 rounded-full border border-slate-700">
                Local Processing Enabled
            </div>
        </header>

        <main class="max-w-6xl mx-auto w-full grid lg:grid-cols-12 gap-12">
            <div class="lg:col-span-5 space-y-8">
                <div class="space-y-2">
                    <h2 class="text-5xl font-black text-white leading-tight">Map your vision.</h2>
                    <p class="text-slate-400">
                        Enter your idea below. It will be embedded and plotted against your data.csv ideas.<br/>
                        Your idea appears as a <span class="text-[#0db9f2] font-bold">large glowing cyan dot</span>.
                    </p>
                </div>

                <div class="bg-slate-800/40 p-1 rounded-[2rem] border border-slate-700/50 shadow-2xl">
                    <textarea id="pitch" class="w-full h-64 p-6 bg-transparent text-white placeholder:text-slate-600 outline-none resize-none text-lg"
                        placeholder="Describe your startup in a few sentences..."></textarea>
                    <button id="analyze-btn" class="w-full py-5 rounded-[1.8rem] bg-[#0db9f2] text-[#101e22] font-black text-xl hover:bg-white transition-all disabled:opacity-50">
                        Run Analysis
                    </button>
                </div>
            </div>

            <div class="lg:col-span-7 flex flex-col gap-6">
                <div class="relative">
                    <div class="h-[500px] bg-[#182d34] rounded-[3rem] border border-slate-700 overflow-hidden shadow-inner">
                        <canvas id="scatter-chart"></canvas>
                        <div id="scanning-line" class="scanning-line hidden"></div>
                    </div>
                    <div id="loading" class="absolute inset-0 flex flex-col items-center justify-center space-y-4 bg-[#182d34]/80">
                        <div class="size-12 border-4 border-[#0db9f2] border-t-transparent rounded-full animate-spin"></div>
                        <p id="status" class="font-bold text-slate-400">Initializing AI Engine...</p>
                    </div>
                </div>

                <div id="result" class="hidden p-8 bg-slate-800/50 border border-[#0db9f2]/30 rounded-[2rem]">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-2xl font-black text-white">Max Semantic Similarity</h3>
                            <p class="text-slate-400 mt-2">
                                Highest cosine similarity to any idea in your dataset.<br/>
                                <span class="text-sm">1.0 = nearly identical · 0.0 = completely different</span>
                            </p>
                        </div>
                        <div class="text-right">
                            <span id="result-score" class="text-4xl font-black text-[#0db9f2]"></span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

        function cosineSimilarity(a, b) {
            let dot = 0;
            let normA = 0;
            let normB = 0;
            for (let i = 0; i < a.length; i++) {
                dot += a[i] * b[i];
                normA += a[i] * a[i];
                normB += b[i] * b[i];
            }
            return dot / (Math.sqrt(normA) * Math.sqrt(normB));
        }

        let extractor = null;
        let registryEmbeddings = [];
        let registryPoints = [];  // All existing ideas (small dark dots)
        let userPoint = null;     // Your idea (large glowing cyan dot)
        let chart = null;
        let REGISTRY_DATA = [];

        const statusEl = document.getElementById('status');
        const loadingEl = document.getElementById('loading');
        const scanningEl = document.getElementById('scanning-line');
        const resultEl = document.getElementById('result');
        const resultScoreEl = document.getElementById('result-score');
        const btn = document.getElementById('analyze-btn');

        async function loadData() {
            try {
                const response = await fetch('data.csv');
                if (!response.ok) throw new Error('Not found');
                const text = await response.text();
                const lines = text.trim().split('\n');
                
                let startIdx = 0;
                if (lines[0] && lines[0].match(/^(idea|startup|description|text|pitch)/i)) {
                    startIdx = 1;
                }
                
                REGISTRY_DATA = lines.slice(startIdx)
                    .map(l => l.trim())
                    .filter(l => l.length > 3);

                if (REGISTRY_DATA.length === 0) throw new Error('Empty');
            } catch (err) {
                statusEl.textContent = 'data.csv not found or empty – using sample data';
                REGISTRY_DATA = [
                    "Uber for dog walking", "Airbnb for boats", "SaaS for freelance taxes",
                    "Social network for collectors", "AI coding assistant", "Drone delivery service",
                    "Subscription box for plants", "Virtual reality fitness app", "Blockchain voting platform",
                    "Sustainable fashion marketplace", "On-demand mental health coaching", "Electric scooter sharing"
                ];
            }
        }

        async function init() {
            await loadData();

            try {
                env.allowLocalModels = false;
                statusEl.textContent = 'Loading AI model (~30-60s first time)';
                extractor = await pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2');

                statusEl.textContent = `Embedding ${REGISTRY_DATA.length} ideas...`;
                registryEmbeddings = [];
                registryPoints = [];

                for (const text of REGISTRY_DATA) {
                    const out = await extractor(text, { pooling: 'mean', normalize: true });
                    const embedding = Array.from(out.data);

                    // Better 2D projection: use first two dimensions directly (more meaningful spread)
                    const x = embedding[0] * 300;
                    const y = embedding[1] * 300;

                    registryEmbeddings.push({ text, embedding });
                    registryPoints.push({
                        x, y,
                        radius: 5,
                        backgroundColor: '#334b55',
                        hoverRadius: 7
                    });
                }

                initChart();
                loadingEl.classList.add('hidden');
            } catch (err) {
                statusEl.textContent = 'Failed to load model';
                console.error(err);
            }
        }

        function initChart() {
            const ctx = document.getElementById('scatter-chart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Existing Ideas',
                            data: registryPoints,
                            backgroundColor: '#334b55',
                            pointRadius: 5,
                            pointHoverRadius: 7
                        },
                        {
                            label: 'Your Idea',
                            data: [],  // Will be filled when analyzing
                            backgroundColor: '#0db9f2',
                            pointRadius: 18,
                            pointHoverRadius: 24,
                            pointStyle: 'circle',
                            borderColor: '#0fffff',
                            borderWidth: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: { display: false, grid: { display: false } },
                        y: { display: false, grid: { display: false } }
                    },
                    animation: {
                        duration: 800
                    }
                }
            });
        }

        async function analyze() {
            const pitch = document.getElementById('pitch').value.trim();
            if (pitch.length < 10) {
                alert('Please enter a longer description.');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Processing...';
            scanningEl.classList.remove('hidden');
            resultEl.classList.add('hidden');

            try {
                const out = await extractor(pitch, { pooling: 'mean', normalize: true });
                const userEmbedding = Array.from(out.data);

                // Use first two dimensions for better visual clustering
                const userX = userEmbedding[0] * 300;
                const userY = userEmbedding[1] * 300;

                userPoint = {
                    x: userX,
                    y: userY
                };

                // Update the "Your Idea" dataset
                chart.data.datasets[1].data = [userPoint];
                chart.update();

                // Calculate max cosine similarity
                let maxSimilarity = 0;
                for (const { embedding } of registryEmbeddings) {
                    const sim = cosineSimilarity(userEmbedding, embedding);
                    if (sim > maxSimilarity) maxSimilarity = sim;
                }

                const score = maxSimilarity.toFixed(3);
                resultScoreEl.textContent = score;
                resultEl.classList.remove('hidden');
            } catch (err) {
                alert('Analysis failed');
                console.error(err);
            }

            btn.disabled = false;
            btn.textContent = 'Run Analysis';
            scanningEl.classList.add('hidden');
        }

        document.getElementById('analyze-btn').addEventListener('click', analyze);

        init();
    </script>
</body>
</html>
